# @package _global_

# to execute this experiment run:
# python train.py experiment=example

defaults:
  - override /data: axov6_vicreg
  - override /algorithm: vicreg
  - override /callbacks: default
  - override /trainer: cpu
  - override /evaluator: default
  - override /evaluator_callbacks: default
  - override /logger: mlflow

tags: ["debug"]

experiment_name: debug
run_name: test

seed: 12345

trainer:
  gradient_clip_algorithm: norm
  gradient_clip_val: 1.0
  # overfit_batches: 1
  min_epochs: 1
  max_epochs: 1
  # max_steps: 1_000
  # limit_train_batches: 10
  limit_val_batches: 10
  limit_test_batches: 10
  # check_val_every_n_epoch: 2

test: true

callbacks:
  min_loss_ckpt:
    _target_: src.callbacks.model_checkpoint.SingleDatasetModelCheckpoint
    dirpath: '${paths.checkpoints_dir}/${experiment_name}/${run_name}'
    monitor: loss
    criterion:
      _target_: src.callbacks.checkpointing.criterion.Min
      top_k: 1
    # skip_ds:
    #   - GluGluHTo2B_Par-MH-125
    #   - GluGluHto2G_Par-MH-125
    #   - GluGluHto2G_Par-MH-90
    #   - GluGluHto2Tau_Par-MH-125
    #   - GluGlutoHHto2B2WtoLNu2Q_Par-c2-0-kl-1-kt-1
    #   - HHHto4B2Tau_Par-c3-0-d4-0
    #   - HHHto6B_Par-c3-0-d4-0
    #   - SUSYGluGluToBBHTo2B_Par-M-1200
    #   - SUSYGluGluToBBHToBB_Par-M-120
    #   - SUSYGluGluToBBHToBB_Par-M-350
    #   - SUSYGluGluToBBHToBB_Par-M-600
    #   - TTHTo2C_Par-MH-125
    #   - TTHto2B_Par-MH-125
    #   - VBFHTo2C_Par-MH-125
    #   - VBFHto2B_Par-MH-125
    #   - VBFHto2Tau_Par-MH-125
    #   - WtoTauto3Mu
    #   - ggH-suep-decay
    #   - haa-4b-ma15
    #   - SingleNeutrino_E-10-gun

evaluator:
  ckpts:
    last: false
    single:
      loss: ['min']

evaluator_callbacks:
  loss:
    _target_: src.evaluation.callbacks.loss.LossCallback
    loss_name: 'loss'
    log_raw_mlflow: false

  knn_auprc:
    _target_: src.evaluation.callbacks.knn_auprc.KNNAUPRC
    output_name: 'vicreg_rep_data'
    reference_sample_size: 20_000
    k: 10
    log_raw_mlflow: false
