# @package _global_

defaults:
  - override /data: axov6
  - override /algorithm: vicreg
  - override /callbacks: default
  - override /trainer: cpu
  - override /evaluator: default
  - override /evaluator_callbacks: default
  - override /logger: mlflow

tags: ["axov6", "vicreg"]

algorithm:
  optimizer:
    lr: ${mul:${lr},${sqrt:${div:${data.batch_size},16384}}}

experiment_name: vicreg_training
run_name: lr${algorithm.optimizer.lr}_var${algorithm.loss.var_coef}_cov${algorithm.loss.cov_coef}

seed: 12345

trainer:
  gradient_clip_algorithm: norm
  gradient_clip_val: 1.0
  min_epochs: 1
  max_epochs: -1
  max_steps: 50_000
  # limit_train_batches: 10
  limit_val_batches: 10
  limit_test_batches: 10

test: true

callbacks:
  log_data_mlflow: null
  min_loss_ckpt: null

evaluator:
  ckpts:
    last: true
    single: null

evaluator_callbacks:
  loss:
    _target_: src.evaluation.callbacks.loss.LossCallback
    loss_name: 'loss'
    log_raw_mlflow: false

  knn_auprc:
    _target_: src.evaluation.callbacks.knn_auprc.KNNAUPRC
    output_name: 'vicreg_rep_data'
    reference_sample_size: 20_000
    k: 10
    log_raw_mlflow: false
